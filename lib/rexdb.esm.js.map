{"version":3,"file":"rexdb.esm.js","sources":["../db/fetch.ts","../utils.ts","../db/core.ts","../db/plugins.ts","../db/index.ts"],"sourcesContent":["const ENV = typeof window === 'undefined' ? 'NODE' : 'BROWSER'\nconst performance = ENV === 'NODE' ? null : window.performance\nimport { AjaxArgsType, RequestType, URLResolve } from './interface'\n\nexport let DEV_PROXY_PORT = null\nconst JSONP_SUPPORT_RETURN = '__REDUX_DB_JSONP_SUPPORT'\n\nexport function setDevProxyPort(port) {\n    DEV_PROXY_PORT = port\n}\n\nexport function ajax(options:AjaxArgsType) {\n    return new Promise((resolve,reject) => {\n        let { data = {},type,query = {},url } = options\n        let sendData:string\n        const {\n            withCredentials,\n            headers = {},\n            cache = 'default',\n            timeout,\n            successStatusRange = [200,300],\n            cancelToken,\n            // add X-HTTP-Method-Override\n            isXHMO,\n            proxy,\n            pipe\n        } = options\n\n        let ContentType\n        if(ENV === 'NODE') {\n            ContentType = headers['Content-Type']\n        } else {\n            ContentType = headers['Content-Type'] || (\n                headers['Content-Type'] = data instanceof FormData \n                    ? 'multipart/form-data' \n                    : 'application/x-www-form-urlencoded'\n            )\n        }\n        \n\n        if(cancelToken) {\n            cancelToken(() => {\n                reject('__FETCH_CANCEL')\n            })    \n        }\n\n        type = type.toUpperCase() as RequestType\n\n        if(proxy) {\n            data['origin'] = url \n            data['method'] = type\n            url = getDevProxyUrl()\n            type = 'POST'\n        } \n\n        if(type === 'GET') {\n            query = {\n                ...data,\n                ...query\n            }\n            if(Object.keys(data).length && Object.keys(query).length) url = handleQuery(url,query)\n        } else {\n            sendData = formatData(ContentType,data)\n        } \n\n        if(isXHMO) {\n            headers['X-HTTP-Method-Override'] = type\n        }\n\n        if(ENV === 'NODE') {\n            const http = require('http')\n            headers['accept-encoding'] = 'gzip, deflate'\n            const httpOptions = {\n                method: type,\n                // headers,\n                // ...timeout ? { timeout } : {}\n            }\n\n            const req = http.request(url, httpOptions,(res) => {\n                if(pipe) {\n                    pipe.set('Content-Type', 'application/octet-stream')\n                    res.pipe(pipe, { end: true })\n                    res.on('end', () => {\n                        resolve()\n                    })\n                } else {\n                    let data = Buffer.alloc(0)\n                    res.on('data', (_data) => {\n                        data = Buffer.concat([data, _data])\n                    })\n                    res.on('end', () => {\n                        resolve({\n                            status: res.statusCode,\n                            data\n                        })\n                    })\n                }\n            })\n            req.end()\n        } else if(typeof fetch === 'undefined') {\n            let xhr = new XMLHttpRequest()\n            xhr.open(type,url,true)\n            for(let header in headers) {\n                xhr.setRequestHeader(header,headers[header])\n            }\n\n            if(timeout) xhr.timeout = timeout\n            xhr.withCredentials = withCredentials\n\n            // 不为multipart/form-data设置c-t\n            ContentType !== 'multipart/form-data' && xhr.setRequestHeader('Content-Type',ContentType ? ContentType : type === 'POST' ? 'application/x-www-form-urlencoded' : 'application/json')\n            xhr.send(type === 'GET' ? '' : sendData) \n            xhr.ontimeout = () => {\n                reject({\n                    status: null,\n                    errMsg: 'timeout'\n                })\n            }\n\n            xhr.onreadystatechange = function() {\n                let requestPerfStart\n                switch (xhr.readyState) {\n                case XMLHttpRequest.OPENED: {\n                    requestPerfStart = performance.now()\n                    break\n                }\n                case XMLHttpRequest.DONE: {\n                    let consume = performance.now() - requestPerfStart\n\n                    checkStatus(successStatusRange,xhr.status) ? resolve({\n                        ... options.perf ? { __consumeTime: consume } : {},\n                        status: xhr.status,\n                        data: xhr.response\n                    }) : reject({\n                        ... options.perf ? { __consumeTime: consume } : {},\n                        status: xhr.status,\n                        errMsg: xhr.response\n                    })\n                    break\n                }\n                }\n            }\n        } else {\n            const opts:RequestInit = {\n                headers,\n                method: type,\n                ... type !== 'GET' ? { body: sendData } : {},\n                cache,\n                credentials: handleCredentials(withCredentials)\n            }\n\n            if(ContentType === 'multipart/form-data') delete headers['Content-Type']\n\n            if(timeout) {\n                if(typeof AbortController !== 'undefined') {\n                    const controller = new AbortController()\n                    opts['signal'] = controller.signal\n                    fetchAndHandle()\n\n                    setTimeout(() => {\n                        controller.abort()\n                        reject('fetch timeout')\n                    },timeout)\n                } \n                else {\n                    Promise.race([\n                        fetchAndHandle(),\n                        new Promise(_ => {\n                            setTimeout(() => reject('fetch timeout'),timeout)\n                        })\n                    ])\n                }\n            } else fetchAndHandle()\n\n            function fetchAndHandle():Promise<unknown> {\n                if(proxy) opts.mode = 'cors'\n                return fetch(url,opts).then((res: Response) => {\n                    if(res.headers.get('Content-Type') == 'application/octet-stream') {\n                        return readStream(res.body)\n                    }\n                    return res\n                }).then(r => handleResult(r))\n                    .then(resolve)\n                    .catch(() => {\n                        debugger\n                        reject()\n                    })\n            }\n\n            function handleResult(res:Response) {\n                const handleContentTypeMap = {\n                    'application/json': () => res.json(),\n                    // 用以支持jsonp,不做任何处理\n                    'application/javascript': () => JSONP_SUPPORT_RETURN,\n                    'application/html': () => res.text(),\n                    'application/text': () => res.text(),\n                }\n                \n                if(successStatusRange ? checkStatus(successStatusRange,res.status) : res.ok) {\n                    let ret = handleContentTypeMap[res.headers.get('contentType') || res.headers.get('content-type')]\n                    return ret && ret() || res.text()\n                } else {\n                    const error = {\n                        state: 'fail',\n                        status: res.status,\n                    }\n                    throw new Error(JSON.stringify(error))\n                }\n            }\n        }\n    })\n}\n\nfunction readStream(readerStream: ReadableStream): Response {\n    const reader = readerStream.getReader()\n    const stream = new ReadableStream({\n        start(controller) {\n            const _read = () => {\n                reader.read().then(({ done, value }) => {\n                    if(done) return controller.close()\n                    console.log(new TextDecoder(\"utf-8\").decode(value))\n                    controller.enqueue(value)\n                    _read()\n                })\n            }\n\n            _read()\n        }\n    })\n    \n    return new Response(stream)\n}\n\n// TODO: 支持strict模式\nfunction handleCredentials(opt:boolean,none:boolean = true):RequestCredentials {\n    // chrome 最新版本要求same-site:lax(不发送绝大多数第三方cookie)\n    // 可手动设置为include(None)或Strict\n    if(opt) return none ? 'include' : 'same-origin'\n    else return 'omit'\n}\n\nfunction handleQuery(url:string,query:object):string {\n    return url + '?' + formatKV(query)\n}\n\nfunction checkStatus(range,status):boolean {\n    if(range && (range as []).pop) {\n        if(status >= range[0] && status < range[1]) return true\n    } \n    return range === status ? true : false\n}\n\nfunction formatData(type:string,data:object):string{\n    let r \n    switch(type) {\n    case 'multipart/form-data': {\n        if(data instanceof FormData) {\n            r = data\n            break\n        }\n\n        r = new FormData()\n        Object.keys(data).forEach(key => {\n            r.append(key,data[key])\n        })\n            \n        break\n    }\n    case 'application/x-www-form-urlencoded' :{\n        r = formatKV(data)\n        break\n    } \n    default: {}\n    case 'application/json': {\n        r = JSON.stringify(data)\n    }\n    }\n\n    return r\n}\n\nfunction formatKV(data:object) {\n    let r = ''\n    for(let k in data) {\n        r += `${k}=${data[k]}&`\n    }\n    return r.substring(0,r.length - 1)\n}\n\nfunction concatTypedArray(a,b) {\n    const concated = new (a.constructor)(a.length + b.length)\n    concated.set(a, 0)\n    concated.set(b, a.length)\n    return concated\n}\n\n// 改为url解析node\nfunction resolveURL(url: string):URLResolve {\n    if(!url.endsWith('/')) url += '/'\n    const match = /.*:\\/\\/(.*?)(?::)?(.*)?\\/(.*)/\n    const resolved = url.match(match)\n    if(!resolved) throw Error('proxy url is not accord standard. example: http://host:port/path')\n    return [resolved[1], resolved[2], resolved[3]]\n}\n\nfunction getDevProxyUrl() {\n    return `http://localhost:${DEV_PROXY_PORT}/proxy`\n}","interface IUtils {\n    extend(target:unknown,ext:object)\n    safeJsonParse(target:string):object\n    safeJsonStringify(target:object): string\n    isSupportPreload():boolean\n    isArray<T=any>(t):t is Array<T>\n}\n\nfunction extend(target:unknown,exts:object) {\n    for(let ext in exts) {\n        target[ext] = exts[ext]\n    }\n}\n\nfunction isArray<T=any>(t:any):t is Array<T>{\n    return Object.prototype.toString.call(t) === '[object Array]'\n}\n\nfunction safeJsonParse(target:string):object{\n    let ret:object\n    try {\n        ret = JSON.parse(target)\n    } catch(e) {\n        ret = {\n            __transform: 'fail',\n            __raw: target\n        }\n    }\n    return ret\n}\n\nfunction safeJsonStringify(target:object):string {\n    let ret:object | string\n    try {\n        ret = JSON.stringify(target)\n    } catch(e) {\n        ret = 'transform fail'\n    }\n    return ret\n}\n\nfunction isSupportPreload() {\n    return (\n        document.createElement('link').relList &&\n        document.createElement('link').relList.supports('preload')\n    )\n}\n\nconst _:IUtils = {\n    isArray,\n    extend,\n    safeJsonParse,\n    isSupportPreload,\n    safeJsonStringify\n}\n\n\nexport default _\n\n","import { CustomMustType,CustomOptionalType } from './interface'\nimport { ajax } from './fetch'\nimport _ from '../utils'\n\nexport const CONVERT_TO_FALSE = 'CONVERT_TO_FALSE'\ninterface IDB extends IPool<DB>{\n    execute:(args:unknown[]) => any\n}\n\ninterface ISenderHooks {\n    before(config:SenderOpts):SenderOpts\n    after(data:unknown):any\n}\n\ninterface ISender extends ISenderHooks,IPool<Sender>,ControlledPool{\n    send()\n    succeed()\n    error(e:any)\n    fetch(opts:CustomMustType)\n}\n\ninterface ControlledPool {\n    autoRelease: boolean\n    persist():void\n}\n\ninterface IPool<T> {\n    release()\n    initConfig(config:T extends DB ? DbOpts : SenderOpts)\n}\n\ntype Before = (config:SenderOpts) => SenderOpts\ntype After = (data:unknown) => any\n\n/**\n * succ和err接口将不被redux-db支持\n * DB类将作为抽象层兼容@tencent/db\n */\nexport type DbOpts = {\n    // 标识race\n    name ?: string,\n    url ?: string,\n    urls ?: string[],\n    isCdnSelect ?: boolean,\n    // TODO: 支持在action里直接调用DB.race\n    succ ?: Function,\n    err ?: Function,\n    before ?: Before[],\n    after ?: After[]\n} & CustomOptionalType\n\n\nexport type SenderOpts = {\n    before ?: Before[]\n    after ?: After[]\n} & DbConfigs\n\ntype DbConfigs = Omit<DbOpts,'err'> & {\n    err: Function[]\n}\n\nconst DBPools:DB[] = []\nconst SenderPools:Sender[] = []\n\nconst DB_CONTAIN_COUNT = 10\nconst SENDER_CONTAIN_COUNT = 10\n\ninterface DBDefaultsConfig {\n    baseUrl ?: string,\n    withCredentials ?: boolean,\n    withBrowserCache ?: boolean,\n}\n\nfunction extendConfigs<T>(configs:T,...exts:object[]):T {\n    for(let ext of exts) {\n        for (let _ext in ext) {\n            let _v = ext[_ext]\n            if(!~['before','after','err'].indexOf(_ext)) configs[_ext] = _v\n            else {\n                _v = _v.pop ? _v : [_v]\n                configs[_ext] && configs[_ext].pop ? (configs[_ext] = [].concat.call(configs[_ext],_v)) : (configs[_ext] = _v) \n            }\n        }\n    }\n\n    // TODO: 字符串解析有两次判断,改用正则匹配\n    if(configs['baseUrl'] !== '' && configs['url']) {\n        let url = configs['url']\n\n        let isHttp = url.indexOf('http://')\n        let isHttps = url.indexOf('https://')\n\n        if(!~isHttp) {\n            let length = 'http://'.length\n            configs['url'] = configs['url'].substring(0,isHttp + length + 1) + configs['url'].substring(isHttp + length)\n        } else if(!~isHttps) {\n            let length = 'https://'.length\n            configs['url'] = configs['url'].substring(0,isHttps + length + 1) + configs['url'].substring(isHttps + length)\n        }\n    }\n\n    return configs\n}\n\nexport class DB implements IDB{\n    static defaults:DBDefaultsConfig = {\n        baseUrl: ''\n    }\n\n    static options = {}\n\n    config:DbConfigs \n\n    constructor(configs:DbOpts) {\n        this.config = DB.configTransform(configs)\n    }\n\n    initConfig(configs:DbOpts) {\n        this.config = DB.configTransform(configs)\n    }\n    \n    /**\n     * fetch\n     * 兼容urls race | all发送\n     */\n    execute() {\n        if(_.isArray(this.config)) {\n            return DB.all(this.config as any)\n        }\n        if(this.config.urls) {\n            let name = this.config.name\n            if(this.config.isCdnSelect && name) {\n                let url\n                if((url = window.sessionStorage.getItem(`__cdn_${name}`))) {\n                    delete this.config['urls']\n                    this.config.url = url\n                    return getSender(this.config).send()\n                }\n            }\n\n            let urls = this.config.urls\n            delete this.config['urls']\n            const fetchMap = urls.map(url => {\n                this.config.url = url\n                return {\n                    ...this.config\n                }\n            })\n\n            return DB.race(fetchMap as any)\n        }\n        \n        // ajax\n        return getSender(this.config).send()\n    }\n\n    release() {\n        if(DBPools.length >= DB_CONTAIN_COUNT) {}\n        else {\n            this.config = null\n            DBPools.push(this)\n        }\n    }\n\n    /**\n     * @static\n     * @param {DbOpts} 传入参数\n     * 将参数转化适配至DbConfigs\n     * 扩展优先级:\n     * 1. custom options\n     * 2. extension options\n     * 3. global defaults\n     */\n    static configTransform(configs:DbOpts):DbConfigs {\n        return extendConfigs<DbConfigs>({\n            before: [],\n            after: [],\n            err: [],\n            type: configs.type ? configs.type : 'GET'\n        } as any as DbConfigs,this.defaults,this.options,configs)\n    }\n\n    static all(...requests:DbOpts[]) {\n        let succ = []\n        let err = []\n        const noop = () => {}\n\n        requests.forEach(r => {\n            succ.push([r.succ])\n            err.push([r.err])\n\n            r.succ = noop\n            r.err = noop\n        })\n\n        return Promise.all(requests.map(r => getDB(r).execute())).then(datas => {\n            succ.forEach((cb,i) => cb && cb(datas[i]))\n            return datas\n        }).catch((e:Error) => {\n            err.forEach(erc => erc && erc(e))\n        })\n    }\n\n    static race(requests:DbOpts[]) {\n        const succ = []\n        const err = []\n        const raceMap = new Map()\n        const noop = () => {}\n\n        requests.forEach((r,i) => {\n            // TODO: 执行回调的错误捕获,不能让一个回调错误影响到后面的执行\n            succ.push([r.succ])\n            err.push([r.err])\n\n            // if cdnselect -> cache url\n            succ.forEach(s => s.unshift((__:any,url:string) => {\n                let name = r.name\n                r.isCdnSelect && name && window.sessionStorage.setItem(`__cdn_${name}`,url)\n            }))\n\n            r.succ = noop\n            r.err = noop\n\n            const raceFlag = Symbol()\n            r['__race_key_'] = raceFlag\n            raceMap.set(raceFlag,i)\n        })\n\n        function executeRaceCb(ret:any,type:'succ' | 'err') {\n            const { __race_key_ } = ret\n            const index = raceMap.get(__race_key_)\n\n            // eslint-disable-next-line\n            if(!index) return console.warn('after拦截器删除了内部RACE标识,请不要操作返回数据之外的键')\n            type === 'succ' ? succ[index].forEach(cb => cb(ret,requests[index].url)) : err[index].forEach(cb => cb(ret))\n        }\n\n        return Promise.race(requests.map(r => getDB(r).execute())).then(data => {\n            executeRaceCb(data,'succ')\n        }).catch((e:Error) => {\n            executeRaceCb(e,'err')\n        })\n    }\n\n    static extendConfigs(exts:object) {\n        extendConfigs(this.options,exts)\n    }\n\n    /**\n     * \n     * @param stage 执行阶段\n     * @param name 注册拦截器名\n     * @param handle 拦截器执行方法\n     * @param fail err拦截器\n     */\n    static addExtension(stage:'before' | 'after',name:string,handle:Function,fail?:Function) {\n        let conf = {},\n            enableKey = handle['enableKey'] || name + 'Enable'\n\n        _.extend(conf, handle['option'] || {})\n\n        if(stage === 'before') {\n            conf[stage] = function (this:Sender,...args:any[]) {\n                if (DB.options[enableKey]) {\n                    if(args[0].bannerPlugins && args[0].bannerPlugins!.includes(name)) return args[0]\n                    return handle.apply(this, args)\n                }\n            }\n        }\n\n        if(stage === 'after') {\n            conf[stage] = function (this:Sender,data:any){\n                let config = this.config\n\n                if (DB.options[enableKey]) {\n                    if(config.bannerPlugins && config.bannerPlugins!.includes(name)) return data\n                    return handle.call(this, data)\n                }\n            }\n        }\n       \n        if(stage === 'after' && fail) {\n            conf['err'] = function (this:Sender,err) {\n                let config = this.config\n                if (DB.options[enableKey]) {\n                    if(config.bannerPlugins && config.bannerPlugins!.includes(name)) return \n                    return fail.call(this, err)\n                }\n            }\n        }\n        \n        this.extendConfigs(conf)\n    }\n\n    static closePlugin(name:string,enableKey = 'Enable') {\n        const t = name + enableKey\n        this.options[t] = false\n    }\n\n    static startPlugin(name:string,enableKey = 'Enable') {\n        const t = name + enableKey\n        this.options[t] = true\n    }\n}\n\nclass Sender implements ISender {\n    autoRelease = false\n    config:SenderOpts = null\n    data = null\n    err = null\n    responseText = ''\n    responseStatus = ''\n\n    constructor(config:SenderOpts) {\n        this.config = config\n    }\n\n    initConfig(config:SenderOpts) {\n        this.config = config\n    }\n\n    persist() {\n        this.autoRelease = false\n    }\n\n    send() {\n        this.config = this.before(this.config)\n        return this.fetch(<CustomMustType>this.config).then(_ => {\n            if(this.err) throw this.err\n            // 拦截器调用的时机在回调之前,否则无法修改数据\n            this.after(this.data)\n            this.succeed()\n            // 注意放入池子的时机,如果需要可以调用persist保持\n            this.autoRelease && this.release()\n\n            // 取出数据\n            return this.data.__raw == undefined ? this.data : this.data.__raw\n        }).catch(err => {\n            this.error(err)\n            throw err\n        })\n    }\n\n    before(config:SenderOpts):SenderOpts {\n        return config.before ? config.before.reduce((_config,cb) => { \n            try {\n                return cb(_config) \n            } catch(e) {\n                console.error(`\n                    before拦截器发生错误,error:${e}\n                `)\n                throw e\n            }\n            \n        },config) : config\n    }\n\n    // transform data before processSucc callback\n    after(data:unknown) {\n        this.data = this.config.after.length ? this.config.after.reduce((_data,cb) => {\n            if(_.isArray(_data) && _data[0] === CONVERT_TO_FALSE) throw new Error(JSON.stringify({\n                type: CONVERT_TO_FALSE,\n                reason: _data[1]\n            }))\n\n            return cb.call(this,_data)\n        },data) : data\n    }\n\n    succeed() {\n        try {            \n            let data = {\n                ...this.data\n            }\n            delete data.__race_key_\n            this.data = data\n            this.config.succ(data) \n        } catch({ message }) {\n            try {\n                let ret = _.safeJsonParse(message)\n                if(ret['type'] === CONVERT_TO_FALSE) this.error(ret)\n            } catch(e) {\n                new Error(e.message)\n            }\n        }\n    }\n\n    error(err){\n        this.config.err && this.config.err.forEach(cb => {\n            cb.call(this,err)\n        })\n    }\n\n    /**\n     * 职责:\n     * 1. 调用内部ajax库\n     * 2. 执行用户提供的transformData,这是用户最先接触到返回数据的地方\n     * 3. 根据策略缓存数据\n     * 4. 注入race所需要的key\n     */\n    fetch(opts:CustomMustType):Promise<void> {\n        const extendOpt = {\n            complete() {}\n        }\n\n        /**\n        * 注入race_key\n        * 否则race执行时无法知道成功的位置\n        */\n        const injectRaceKey = data => {\n            _.extend(data,{\n                __race_key_: this.config['__race_key_']\n            })\n        }\n       \n        return ajax({ ...opts, ...extendOpt }).then(r => {\n            \n            let { transformData } = this.config\n            let data:string | object = _.safeJsonParse(r as any)\n\n            // 对本身就是string类型的返回值不进入任何处理\n            // if(data['__transform'] === 'fail') data = data['__raw'] \n\n            if(transformData && typeof transformData === 'function') {\n                r = transformData(r)\n            } else new Error('transformData isn\\'t a function')\n\n            // 在注入race key之前缓存\n            let key \n            if((key = this.config.updateCache && this.config.updateCache.key)) {\n                window.localStorage.setItem(key, typeof data === 'object' ? _.safeJsonStringify(data) : data)\n            }\n\n            injectRaceKey(data)\n            this.data = data\n        }).catch((_err:object | string) => {\n            let err \n            if(typeof _err !== 'object') {\n                err = {\n                    msg: _err,\n                    ... _err === '__FETCH_CANCEL' ? { reason: 'request is canceled' } : {}\n                }\n            }\n            \n            else err = _err\n            injectRaceKey(err)\n            this.err = err\n        })\n    }\n\n    release() {\n        if(SenderPools.length >= SENDER_CONTAIN_COUNT) {}\n        else {\n            this.config = null\n            this.data = null\n            this.responseText = null\n            this.responseStatus = null\n\n            SenderPools.push(this)\n        }\n    }\n}   \n\nexport function getSender(opts:SenderOpts) {\n    if(SenderPools.length) {\n        let sender = SenderPools.pop()\n        sender.initConfig(opts)\n        return sender\n    }\n    else {\n        const useSender = new Sender(opts)\n        return useSender\n    }\n}\n\nexport function getDB(opts:DbOpts):DB {\n    autoAddSchemaPrefix(opts)\n    if(DBPools.length) {\n        let db = DBPools.pop()\n        db.initConfig(opts)\n        return db\n    }\n    else {\n        const useDb = new DB(opts)\n        return useDb\n    }\n}\n\nfunction autoAddSchemaPrefix(opts: DbOpts) {\n    const checkAndHandleUrl = (url: string) => /.*\\/\\//.test(url) ? url : 'http://' + url\n    if(opts.url) {\n        opts.url = checkAndHandleUrl(opts.url)\n    } else if(opts.urls) {\n        opts.urls.forEach((url,i,urls) => {\n            urls[i] = checkAndHandleUrl(url)\n        })\n    }\n}\n\nexport namespace DB {\n    interface IAfterUse {\n        (handler,name,err ?: Function):any\n    }\n    interface IBeforeUse {\n        (handler,name):any\n    }\n\n    interface IStageInterceptor<T> {\n        use:T\n    }\n    interface IInterceptors {\n        after:IStageInterceptor<IAfterUse>\n        before:IStageInterceptor<IBeforeUse>\n    }\n\n    export let interceptors:IInterceptors\n}\n","import { DB } from './core'\nimport _ from '../utils'\n\ninterface IDbExts {\n    before:object\n    after:object\n}\n\nconst dbExts:IDbExts = {\n    before: {},\n    after: {}\n}\n\nfunction useInterceptor(stage:'after' | 'before',name,interceptor,fail ?: Function) {\n    DB.addExtension(stage,name,interceptor,fail)\n    DB.startPlugin(name)\n}\n\nconst SenderInterceptors = {\n    interceptors: {\n        before: {\n            use(interceptor,name ?: string) {\n                useInterceptor('before',name,interceptor)\n            }\n        },\n        after: {\n            use(interceptor,name ?: string,fail ?: Function) {\n                useInterceptor('after',name,interceptor,fail)\n            }\n        }\n    }\n}\n\n_.extend(DB,{\n    interceptors: SenderInterceptors.interceptors\n})\n\nexport default dbExts","import { getDB,DbOpts,DB } from './core'\nimport dbExts from './plugins'\nimport { DEV_PROXY_PORT, setDevProxyPort } from '../db/fetch'\n\nconst startCheckPort = 25918\nfunction useDB(autoFetch:boolean,opts:DbOpts):Promise<any>;\nfunction useDB(opts:DbOpts):DB;\n\nfunction useDB(...options):Promise<any> | DB {\n    let db:DB\n    const autoFetch = options[0]\n    if(autoFetch === true) {\n        if(options[1].proxy && !DEV_PROXY_PORT) {\n            return new Promise(resolve => {\n                checkProxyServerStart(() => {\n                    db = getDB(options[1])\n                    resolve(db.execute())\n                })\n            })\n        } \n        db = getDB(options[1])\n        return db.execute()\n    } else {\n        if(options[1].proxy && !DEV_PROXY_PORT) {\n            return new Promise(resolve => {\n                checkProxyServerStart(() => {\n                    db = getDB(autoFetch)\n                    resolve(db)\n                })\n            })\n        }\n        db = getDB(autoFetch)\n        return db\n    }\n}\n\nfunction useFetch(options:DbOpts):Promise<any> {\n    return useDB(true, options)\n}\n\nfunction initDbExts() {\n    for(let stage in dbExts) {\n        let handles = dbExts[stage]\n        for(let name in handles) {\n            DB.addExtension(stage as any,name,handles[name])\n            DB.startPlugin(name)\n        }\n    }\n}\n\nfunction checkProxyServerStart(cb:Function) {\n    checkPort(startCheckPort, cb)\n}\n\nfunction checkPort(port, cb) {\n    useFetch({\n        url: `localhost:${port}/check`,\n        timeout: 500,\n    }).then(() => {\n        setDevProxyPort(port)\n        cb()\n    }, () => {\n        checkPort(port + 1, cb)\n    })\n}\n\nfunction initWork() {\n    initDbExts()\n}\n\ninitWork()\n\nexport { \n    DB, \n    useDB,\n    useFetch\n}\n"],"names":[],"mappings":";;;;;;IAAA,MAAM,GAAG,GAAG,OAAO,MAAM,KAAK,WAAW,GAAG,MAAM,GAAG,SAAS,CAAA;IAC9D,MAAM,WAAW,GAAG,GAAG,KAAK,MAAM,GAAG,IAAI,GAAG,MAAM,CAAC,WAAW,CAAA;IAGvD,IAAI,cAAc,GAAG,IAAI,CAAA;IAChC,MAAM,oBAAoB,GAAG,0BAA0B,CAAA;aAEvC,eAAe,CAAC,IAAI;QAChC,cAAc,GAAG,IAAI,CAAA;IACzB,CAAC;aAEe,IAAI,CAAC,OAAoB;QACrC,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAC,MAAM;YAC9B,IAAI,EAAE,IAAI,GAAG,EAAE,EAAC,IAAI,EAAC,KAAK,GAAG,EAAE,EAAC,GAAG,EAAE,GAAG,OAAO,CAAA;YAC/C,IAAI,QAAe,CAAA;YACnB,MAAM,EACF,eAAe,EACf,OAAO,GAAG,EAAE,EACZ,KAAK,GAAG,SAAS,EACjB,OAAO,EACP,kBAAkB,GAAG,CAAC,GAAG,EAAC,GAAG,CAAC,EAC9B,WAAW;;YAEX,MAAM,EACN,KAAK,EACL,IAAI,EACP,GAAG,OAAO,CAAA;YAEX,IAAI,WAAW,CAAA;YACf,IAAG,GAAG,KAAK,MAAM,EAAE;gBACf,WAAW,GAAG,OAAO,CAAC,cAAc,CAAC,CAAA;aACxC;iBAAM;gBACH,WAAW,GAAG,OAAO,CAAC,cAAc,CAAC,KACjC,OAAO,CAAC,cAAc,CAAC,GAAG,IAAI,YAAY,QAAQ;sBAC5C,qBAAqB;sBACrB,mCAAmC,CAC5C,CAAA;aACJ;YAGD,IAAG,WAAW,EAAE;gBACZ,WAAW,CAAC;oBACR,MAAM,CAAC,gBAAgB,CAAC,CAAA;iBAC3B,CAAC,CAAA;aACL;YAED,IAAI,GAAG,IAAI,CAAC,WAAW,EAAiB,CAAA;YAExC,IAAG,KAAK,EAAE;gBACN,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAA;gBACpB,IAAI,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAA;gBACrB,GAAG,GAAG,cAAc,EAAE,CAAA;gBACtB,IAAI,GAAG,MAAM,CAAA;aAChB;YAED,IAAG,IAAI,KAAK,KAAK,EAAE;gBACf,KAAK,mCACE,IAAI,GACJ,KAAK,CACX,CAAA;gBACD,IAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM;oBAAE,GAAG,GAAG,WAAW,CAAC,GAAG,EAAC,KAAK,CAAC,CAAA;aACzF;iBAAM;gBACH,QAAQ,GAAG,UAAU,CAAC,WAAW,EAAC,IAAI,CAAC,CAAA;aAC1C;YAED,IAAG,MAAM,EAAE;gBACP,OAAO,CAAC,wBAAwB,CAAC,GAAG,IAAI,CAAA;aAC3C;YAED,IAAG,GAAG,KAAK,MAAM,EAAE;gBACf,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;gBAC5B,OAAO,CAAC,iBAAiB,CAAC,GAAG,eAAe,CAAA;gBAC5C,MAAM,WAAW,GAAG;oBAChB,MAAM,EAAE,IAAI;iBAGf,CAAA;gBAED,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,WAAW,EAAC,CAAC,GAAG;oBAC1C,IAAG,IAAI,EAAE;wBACL,IAAI,CAAC,GAAG,CAAC,cAAc,EAAE,0BAA0B,CAAC,CAAA;wBACpD,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAA;wBAC7B,GAAG,CAAC,EAAE,CAAC,KAAK,EAAE;4BACV,OAAO,EAAE,CAAA;yBACZ,CAAC,CAAA;qBACL;yBAAM;wBACH,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;wBAC1B,GAAG,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK;4BACjB,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAA;yBACtC,CAAC,CAAA;wBACF,GAAG,CAAC,EAAE,CAAC,KAAK,EAAE;4BACV,OAAO,CAAC;gCACJ,MAAM,EAAE,GAAG,CAAC,UAAU;gCACtB,IAAI;6BACP,CAAC,CAAA;yBACL,CAAC,CAAA;qBACL;iBACJ,CAAC,CAAA;gBACF,GAAG,CAAC,GAAG,EAAE,CAAA;aACZ;iBAAM,IAAG,OAAO,KAAK,KAAK,WAAW,EAAE;gBACpC,IAAI,GAAG,GAAG,IAAI,cAAc,EAAE,CAAA;gBAC9B,GAAG,CAAC,IAAI,CAAC,IAAI,EAAC,GAAG,EAAC,IAAI,CAAC,CAAA;gBACvB,KAAI,IAAI,MAAM,IAAI,OAAO,EAAE;oBACvB,GAAG,CAAC,gBAAgB,CAAC,MAAM,EAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAA;iBAC/C;gBAED,IAAG,OAAO;oBAAE,GAAG,CAAC,OAAO,GAAG,OAAO,CAAA;gBACjC,GAAG,CAAC,eAAe,GAAG,eAAe,CAAA;;gBAGrC,WAAW,KAAK,qBAAqB,IAAI,GAAG,CAAC,gBAAgB,CAAC,cAAc,EAAC,WAAW,GAAG,WAAW,GAAG,IAAI,KAAK,MAAM,GAAG,mCAAmC,GAAG,kBAAkB,CAAC,CAAA;gBACpL,GAAG,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,GAAG,EAAE,GAAG,QAAQ,CAAC,CAAA;gBACxC,GAAG,CAAC,SAAS,GAAG;oBACZ,MAAM,CAAC;wBACH,MAAM,EAAE,IAAI;wBACZ,MAAM,EAAE,SAAS;qBACpB,CAAC,CAAA;iBACL,CAAA;gBAED,GAAG,CAAC,kBAAkB,GAAG;oBACrB,IAAI,gBAAgB,CAAA;oBACpB,QAAQ,GAAG,CAAC,UAAU;wBACtB,KAAK,cAAc,CAAC,MAAM,EAAE;4BACxB,gBAAgB,GAAG,WAAW,CAAC,GAAG,EAAE,CAAA;4BACpC,MAAK;yBACR;wBACD,KAAK,cAAc,CAAC,IAAI,EAAE;4BACtB,IAAI,OAAO,GAAG,WAAW,CAAC,GAAG,EAAE,GAAG,gBAAgB,CAAA;4BAElD,WAAW,CAAC,kBAAkB,EAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,iCAC5C,OAAO,CAAC,IAAI,GAAG,EAAE,aAAa,EAAE,OAAO,EAAE,GAAG,EAAE,KAClD,MAAM,EAAE,GAAG,CAAC,MAAM,EAClB,IAAI,EAAE,GAAG,CAAC,QAAQ,IACpB,GAAG,MAAM,iCACH,OAAO,CAAC,IAAI,GAAG,EAAE,aAAa,EAAE,OAAO,EAAE,GAAG,EAAE,KAClD,MAAM,EAAE,GAAG,CAAC,MAAM,EAClB,MAAM,EAAE,GAAG,CAAC,QAAQ,IACtB,CAAA;4BACF,MAAK;yBACR;qBACA;iBACJ,CAAA;aACJ;iBAAM;gBACH,MAAM,IAAI,iCACN,OAAO,EACP,MAAM,EAAE,IAAI,IACR,IAAI,KAAK,KAAK,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,EAAE,KAC5C,KAAK,EACL,WAAW,EAAE,iBAAiB,CAAC,eAAe,CAAC,GAClD,CAAA;gBAED,IAAG,WAAW,KAAK,qBAAqB;oBAAE,OAAO,OAAO,CAAC,cAAc,CAAC,CAAA;gBAExE,IAAG,OAAO,EAAE;oBACR,IAAG,OAAO,eAAe,KAAK,WAAW,EAAE;wBACvC,MAAM,UAAU,GAAG,IAAI,eAAe,EAAE,CAAA;wBACxC,IAAI,CAAC,QAAQ,CAAC,GAAG,UAAU,CAAC,MAAM,CAAA;wBAClC,cAAc,EAAE,CAAA;wBAEhB,UAAU,CAAC;4BACP,UAAU,CAAC,KAAK,EAAE,CAAA;4BAClB,MAAM,CAAC,eAAe,CAAC,CAAA;yBAC1B,EAAC,OAAO,CAAC,CAAA;qBACb;yBACI;wBACD,OAAO,CAAC,IAAI,CAAC;4BACT,cAAc,EAAE;4BAChB,IAAI,OAAO,CAAC,CAAC;gCACT,UAAU,CAAC,MAAM,MAAM,CAAC,eAAe,CAAC,EAAC,OAAO,CAAC,CAAA;6BACpD,CAAC;yBACL,CAAC,CAAA;qBACL;iBACJ;;oBAAM,cAAc,EAAE,CAAA;gBAEvB,SAAS,cAAc;oBACnB,IAAG,KAAK;wBAAE,IAAI,CAAC,IAAI,GAAG,MAAM,CAAA;oBAC5B,OAAO,KAAK,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,GAAa;wBACtC,IAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,0BAA0B,EAAE;4BAC9D,OAAO,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;yBAC9B;wBACD,OAAO,GAAG,CAAA;qBACb,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,YAAY,CAAC,CAAC,CAAC,CAAC;yBACxB,IAAI,CAAC,OAAO,CAAC;yBACb,KAAK,CAAC;wBACH,SAAQ;wBACR,MAAM,EAAE,CAAA;qBACX,CAAC,CAAA;iBACT;gBAED,SAAS,YAAY,CAAC,GAAY;oBAC9B,MAAM,oBAAoB,GAAG;wBACzB,kBAAkB,EAAE,MAAM,GAAG,CAAC,IAAI,EAAE;;wBAEpC,wBAAwB,EAAE,MAAM,oBAAoB;wBACpD,kBAAkB,EAAE,MAAM,GAAG,CAAC,IAAI,EAAE;wBACpC,kBAAkB,EAAE,MAAM,GAAG,CAAC,IAAI,EAAE;qBACvC,CAAA;oBAED,IAAG,kBAAkB,GAAG,WAAW,CAAC,kBAAkB,EAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,EAAE,EAAE;wBACzE,IAAI,GAAG,GAAG,oBAAoB,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAA;wBACjG,OAAO,GAAG,IAAI,GAAG,EAAE,IAAI,GAAG,CAAC,IAAI,EAAE,CAAA;qBACpC;yBAAM;wBACH,MAAM,KAAK,GAAG;4BACV,KAAK,EAAE,MAAM;4BACb,MAAM,EAAE,GAAG,CAAC,MAAM;yBACrB,CAAA;wBACD,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAA;qBACzC;iBACJ;aACJ;SACJ,CAAC,CAAA;IACN,CAAC;IAED,SAAS,UAAU,CAAC,YAA4B;QAC5C,MAAM,MAAM,GAAG,YAAY,CAAC,SAAS,EAAE,CAAA;QACvC,MAAM,MAAM,GAAG,IAAI,cAAc,CAAC;YAC9B,KAAK,CAAC,UAAU;gBACZ,MAAM,KAAK,GAAG;oBACV,MAAM,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE;wBAC/B,IAAG,IAAI;4BAAE,OAAO,UAAU,CAAC,KAAK,EAAE,CAAA;wBAClC,OAAO,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAA;wBACnD,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;wBACzB,KAAK,EAAE,CAAA;qBACV,CAAC,CAAA;iBACL,CAAA;gBAED,KAAK,EAAE,CAAA;aACV;SACJ,CAAC,CAAA;QAEF,OAAO,IAAI,QAAQ,CAAC,MAAM,CAAC,CAAA;IAC/B,CAAC;IAED;IACA,SAAS,iBAAiB,CAAC,GAAW,EAAC,OAAe,IAAI;;;QAGtD,IAAG,GAAG;YAAE,OAAO,IAAI,GAAG,SAAS,GAAG,aAAa,CAAA;;YAC1C,OAAO,MAAM,CAAA;IACtB,CAAC;IAED,SAAS,WAAW,CAAC,GAAU,EAAC,KAAY;QACxC,OAAO,GAAG,GAAG,GAAG,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAA;IACtC,CAAC;IAED,SAAS,WAAW,CAAC,KAAK,EAAC,MAAM;QAC7B,IAAG,KAAK,IAAK,KAAY,CAAC,GAAG,EAAE;YAC3B,IAAG,MAAM,IAAI,KAAK,CAAC,CAAC,CAAC,IAAI,MAAM,GAAG,KAAK,CAAC,CAAC,CAAC;gBAAE,OAAO,IAAI,CAAA;SAC1D;QACD,OAAO,KAAK,KAAK,MAAM,GAAG,IAAI,GAAG,KAAK,CAAA;IAC1C,CAAC;IAED,SAAS,UAAU,CAAC,IAAW,EAAC,IAAW;QACvC,IAAI,CAAC,CAAA;QACL,QAAO,IAAI;YACX,KAAK,qBAAqB,EAAE;gBACxB,IAAG,IAAI,YAAY,QAAQ,EAAE;oBACzB,CAAC,GAAG,IAAI,CAAA;oBACR,MAAK;iBACR;gBAED,CAAC,GAAG,IAAI,QAAQ,EAAE,CAAA;gBAClB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,GAAG;oBACzB,CAAC,CAAC,MAAM,CAAC,GAAG,EAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAA;iBAC1B,CAAC,CAAA;gBAEF,MAAK;aACR;YACD,KAAK,mCAAoC,EAAC;gBACtC,CAAC,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAA;gBAClB,MAAK;aACR;YACD,gBACA,KAAK,kBAAkB,EAAE;gBACrB,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;aAC3B;SACA;QAED,OAAO,CAAC,CAAA;IACZ,CAAC;IAED,SAAS,QAAQ,CAAC,IAAW;QACzB,IAAI,CAAC,GAAG,EAAE,CAAA;QACV,KAAI,IAAI,CAAC,IAAI,IAAI,EAAE;YACf,CAAC,IAAI,GAAG,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,GAAG,CAAA;SAC1B;QACD,OAAO,CAAC,CAAC,SAAS,CAAC,CAAC,EAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;IACtC,CAAC;IAkBD,SAAS,cAAc;QACnB,OAAO,oBAAoB,cAAc,QAAQ,CAAA;IACrD;;IC3SA,SAAS,MAAM,CAAC,MAAc,EAAC,IAAW;QACtC,KAAI,IAAI,GAAG,IAAI,IAAI,EAAE;YACjB,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAA;SAC1B;IACL,CAAC;IAED,SAAS,OAAO,CAAQ,CAAK;QACzB,OAAO,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,gBAAgB,CAAA;IACjE,CAAC;IAED,SAAS,aAAa,CAAC,MAAa;QAChC,IAAI,GAAU,CAAA;QACd,IAAI;YACA,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;SAC3B;QAAC,OAAM,CAAC,EAAE;YACP,GAAG,GAAG;gBACF,WAAW,EAAE,MAAM;gBACnB,KAAK,EAAE,MAAM;aAChB,CAAA;SACJ;QACD,OAAO,GAAG,CAAA;IACd,CAAC;IAED,SAAS,iBAAiB,CAAC,MAAa;QACpC,IAAI,GAAmB,CAAA;QACvB,IAAI;YACA,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAA;SAC/B;QAAC,OAAM,CAAC,EAAE;YACP,GAAG,GAAG,gBAAgB,CAAA;SACzB;QACD,OAAO,GAAG,CAAA;IACd,CAAC;IAED,SAAS,gBAAgB;QACrB,QACI,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,OAAO;YACtC,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,EAC7D;IACL,CAAC;IAED,MAAM,CAAC,GAAU;QACb,OAAO;QACP,MAAM;QACN,aAAa;QACb,gBAAgB;QAChB,iBAAiB;KACpB;;IClDM,MAAM,gBAAgB,GAAG,kBAAkB,CAAA;IAyDlD,MAAM,OAAO,GAAQ,EAAE,CAAA;IACvB,MAAM,WAAW,GAAY,EAAE,CAAA;IAE/B,MAAM,gBAAgB,GAAG,EAAE,CAAA;IAC3B,MAAM,oBAAoB,GAAG,EAAE,CAAA;IAQ/B,SAAS,aAAa,CAAI,OAAS,EAAC,GAAG,IAAa;QAChD,KAAI,IAAI,GAAG,IAAI,IAAI,EAAE;YACjB,KAAK,IAAI,IAAI,IAAI,GAAG,EAAE;gBAClB,IAAI,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC,CAAA;gBAClB,IAAG,CAAC,CAAC,CAAC,QAAQ,EAAC,OAAO,EAAC,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;oBAAE,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,CAAA;qBAC1D;oBACD,EAAE,GAAG,EAAE,CAAC,GAAG,GAAG,EAAE,GAAG,CAAC,EAAE,CAAC,CAAA;oBACvB,OAAO,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAC,EAAE,CAAC,KAAK,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAA;iBACjH;aACJ;SACJ;;QAGD,IAAG,OAAO,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,OAAO,CAAC,KAAK,CAAC,EAAE;YAC5C,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAA;YAExB,IAAI,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;YACnC,IAAI,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;YAErC,IAAG,CAAC,CAAC,MAAM,EAAE;gBACT,IAAI,MAAM,GAAG,SAAS,CAAC,MAAM,CAAA;gBAC7B,OAAO,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,EAAC,MAAM,GAAG,MAAM,GAAG,CAAC,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,MAAM,GAAG,MAAM,CAAC,CAAA;aAC/G;iBAAM,IAAG,CAAC,CAAC,OAAO,EAAE;gBACjB,IAAI,MAAM,GAAG,UAAU,CAAC,MAAM,CAAA;gBAC9B,OAAO,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,CAAC,EAAC,OAAO,GAAG,MAAM,GAAG,CAAC,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,OAAO,GAAG,MAAM,CAAC,CAAA;aACjH;SACJ;QAED,OAAO,OAAO,CAAA;IAClB,CAAC;UAEY,EAAE;QASX,YAAY,OAAc;YACtB,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,eAAe,CAAC,OAAO,CAAC,CAAA;SAC5C;QAED,UAAU,CAAC,OAAc;YACrB,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,eAAe,CAAC,OAAO,CAAC,CAAA;SAC5C;;;;;QAMD,OAAO;YACH,IAAG,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;gBACvB,OAAO,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,MAAa,CAAC,CAAA;aACpC;YACD,IAAG,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;gBACjB,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAA;gBAC3B,IAAG,IAAI,CAAC,MAAM,CAAC,WAAW,IAAI,IAAI,EAAE;oBAChC,IAAI,GAAG,CAAA;oBACP,KAAI,GAAG,GAAG,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,SAAS,IAAI,EAAE,CAAC,GAAG;wBACvD,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;wBAC1B,IAAI,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,CAAA;wBACrB,OAAO,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAA;qBACvC;iBACJ;gBAED,IAAI,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAA;gBAC3B,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;gBAC1B,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG;oBACzB,IAAI,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,CAAA;oBACrB,yBACO,IAAI,CAAC,MAAM,EACjB;iBACJ,CAAC,CAAA;gBAEF,OAAO,EAAE,CAAC,IAAI,CAAC,QAAe,CAAC,CAAA;aAClC;;YAGD,OAAO,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAA;SACvC;QAED,OAAO;YACH,IAAG,OAAO,CAAC,MAAM,IAAI,gBAAgB,EAAE,CAAE;iBACpC;gBACD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;gBAClB,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;aACrB;SACJ;;;;;;;;;;QAWD,OAAO,eAAe,CAAC,OAAc;YACjC,OAAO,aAAa,CAAY;gBAC5B,MAAM,EAAE,EAAE;gBACV,KAAK,EAAE,EAAE;gBACT,GAAG,EAAE,EAAE;gBACP,IAAI,EAAE,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,GAAG,KAAK;aACxB,EAAC,IAAI,CAAC,QAAQ,EAAC,IAAI,CAAC,OAAO,EAAC,OAAO,CAAC,CAAA;SAC5D;QAED,OAAO,GAAG,CAAC,GAAG,QAAiB;YAC3B,IAAI,IAAI,GAAG,EAAE,CAAA;YACb,IAAI,GAAG,GAAG,EAAE,CAAA;YACZ,MAAM,IAAI,GAAG,SAAQ,CAAA;YAErB,QAAQ,CAAC,OAAO,CAAC,CAAC;gBACd,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;gBACnB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAA;gBAEjB,CAAC,CAAC,IAAI,GAAG,IAAI,CAAA;gBACb,CAAC,CAAC,GAAG,GAAG,IAAI,CAAA;aACf,CAAC,CAAA;YAEF,OAAO,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK;gBAChE,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,EAAC,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;gBAC1C,OAAO,KAAK,CAAA;aACf,CAAC,CAAC,KAAK,CAAC,CAAC,CAAO;gBACb,GAAG,CAAC,OAAO,CAAC,GAAG,IAAI,GAAG,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;aACpC,CAAC,CAAA;SACL;QAED,OAAO,IAAI,CAAC,QAAiB;YACzB,MAAM,IAAI,GAAG,EAAE,CAAA;YACf,MAAM,GAAG,GAAG,EAAE,CAAA;YACd,MAAM,OAAO,GAAG,IAAI,GAAG,EAAE,CAAA;YACzB,MAAM,IAAI,GAAG,SAAQ,CAAA;YAErB,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAC,CAAC;;gBAEjB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;gBACnB,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAA;;gBAGjB,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,EAAM,EAAC,GAAU;oBAC1C,IAAI,IAAI,GAAG,CAAC,CAAC,IAAI,CAAA;oBACjB,CAAC,CAAC,WAAW,IAAI,IAAI,IAAI,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,SAAS,IAAI,EAAE,EAAC,GAAG,CAAC,CAAA;iBAC9E,CAAC,CAAC,CAAA;gBAEH,CAAC,CAAC,IAAI,GAAG,IAAI,CAAA;gBACb,CAAC,CAAC,GAAG,GAAG,IAAI,CAAA;gBAEZ,MAAM,QAAQ,GAAG,MAAM,EAAE,CAAA;gBACzB,CAAC,CAAC,aAAa,CAAC,GAAG,QAAQ,CAAA;gBAC3B,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAC,CAAC,CAAC,CAAA;aAC1B,CAAC,CAAA;YAEF,SAAS,aAAa,CAAC,GAAO,EAAC,IAAmB;gBAC9C,MAAM,EAAE,WAAW,EAAE,GAAG,GAAG,CAAA;gBAC3B,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;;gBAGtC,IAAG,CAAC,KAAK;oBAAE,OAAO,OAAO,CAAC,IAAI,CAAC,mCAAmC,CAAC,CAAA;gBACnE,IAAI,KAAK,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,CAAC,GAAG,EAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,EAAE,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,CAAA;aAC/G;YAED,OAAO,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI;gBAChE,aAAa,CAAC,IAAI,EAAC,MAAM,CAAC,CAAA;aAC7B,CAAC,CAAC,KAAK,CAAC,CAAC,CAAO;gBACb,aAAa,CAAC,CAAC,EAAC,KAAK,CAAC,CAAA;aACzB,CAAC,CAAA;SACL;QAED,OAAO,aAAa,CAAC,IAAW;YAC5B,aAAa,CAAC,IAAI,CAAC,OAAO,EAAC,IAAI,CAAC,CAAA;SACnC;;;;;;;;QASD,OAAO,YAAY,CAAC,KAAwB,EAAC,IAAW,EAAC,MAAe,EAAC,IAAc;YACnF,IAAI,IAAI,GAAG,EAAE,EACT,SAAS,GAAG,MAAM,CAAC,WAAW,CAAC,IAAI,IAAI,GAAG,QAAQ,CAAA;YAEtD,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAA;YAEtC,IAAG,KAAK,KAAK,QAAQ,EAAE;gBACnB,IAAI,CAAC,KAAK,CAAC,GAAG,UAAsB,GAAG,IAAU;oBAC7C,IAAI,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;wBACvB,IAAG,IAAI,CAAC,CAAC,CAAC,CAAC,aAAa,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,aAAc,CAAC,QAAQ,CAAC,IAAI,CAAC;4BAAE,OAAO,IAAI,CAAC,CAAC,CAAC,CAAA;wBACjF,OAAO,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;qBAClC;iBACJ,CAAA;aACJ;YAED,IAAG,KAAK,KAAK,OAAO,EAAE;gBAClB,IAAI,CAAC,KAAK,CAAC,GAAG,UAAsB,IAAQ;oBACxC,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;oBAExB,IAAI,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;wBACvB,IAAG,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC,aAAc,CAAC,QAAQ,CAAC,IAAI,CAAC;4BAAE,OAAO,IAAI,CAAA;wBAC5E,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;qBACjC;iBACJ,CAAA;aACJ;YAED,IAAG,KAAK,KAAK,OAAO,IAAI,IAAI,EAAE;gBAC1B,IAAI,CAAC,KAAK,CAAC,GAAG,UAAsB,GAAG;oBACnC,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;oBACxB,IAAI,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;wBACvB,IAAG,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC,aAAc,CAAC,QAAQ,CAAC,IAAI,CAAC;4BAAE,OAAM;wBACvE,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAA;qBAC9B;iBACJ,CAAA;aACJ;YAED,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;SAC3B;QAED,OAAO,WAAW,CAAC,IAAW,EAAC,SAAS,GAAG,QAAQ;YAC/C,MAAM,CAAC,GAAG,IAAI,GAAG,SAAS,CAAA;YAC1B,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,KAAK,CAAA;SAC1B;QAED,OAAO,WAAW,CAAC,IAAW,EAAC,SAAS,GAAG,QAAQ;YAC/C,MAAM,CAAC,GAAG,IAAI,GAAG,SAAS,CAAA;YAC1B,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,CAAA;SACzB;;IArMM,WAAQ,GAAoB;QAC/B,OAAO,EAAE,EAAE;KACd,CAAA;IAEM,UAAO,GAAG,EAAE,CAAA;IAoMvB,MAAM,MAAM;QAQR,YAAY,MAAiB;YAP7B,gBAAW,GAAG,KAAK,CAAA;YACnB,WAAM,GAAc,IAAI,CAAA;YACxB,SAAI,GAAG,IAAI,CAAA;YACX,QAAG,GAAG,IAAI,CAAA;YACV,iBAAY,GAAG,EAAE,CAAA;YACjB,mBAAc,GAAG,EAAE,CAAA;YAGf,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;SACvB;QAED,UAAU,CAAC,MAAiB;YACxB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;SACvB;QAED,OAAO;YACH,IAAI,CAAC,WAAW,GAAG,KAAK,CAAA;SAC3B;QAED,IAAI;YACA,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;YACtC,OAAO,IAAI,CAAC,KAAK,CAAiB,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC;gBACjD,IAAG,IAAI,CAAC,GAAG;oBAAE,MAAM,IAAI,CAAC,GAAG,CAAA;;gBAE3B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;gBACrB,IAAI,CAAC,OAAO,EAAE,CAAA;;gBAEd,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,OAAO,EAAE,CAAA;;gBAGlC,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAA;aACpE,CAAC,CAAC,KAAK,CAAC,GAAG;gBACR,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;gBACf,MAAM,GAAG,CAAA;aACZ,CAAC,CAAA;SACL;QAED,MAAM,CAAC,MAAiB;YACpB,OAAO,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,EAAC,EAAE;gBACnD,IAAI;oBACA,OAAO,EAAE,CAAC,OAAO,CAAC,CAAA;iBACrB;gBAAC,OAAM,CAAC,EAAE;oBACP,OAAO,CAAC,KAAK,CAAC;0CACY,CAAC;iBAC1B,CAAC,CAAA;oBACF,MAAM,CAAC,CAAA;iBACV;aAEJ,EAAC,MAAM,CAAC,GAAG,MAAM,CAAA;SACrB;;QAGD,KAAK,CAAC,IAAY;YACd,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,EAAC,EAAE;gBACrE,IAAG,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,gBAAgB;oBAAE,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC;wBACjF,IAAI,EAAE,gBAAgB;wBACtB,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;qBACnB,CAAC,CAAC,CAAA;gBAEH,OAAO,EAAE,CAAC,IAAI,CAAC,IAAI,EAAC,KAAK,CAAC,CAAA;aAC7B,EAAC,IAAI,CAAC,GAAG,IAAI,CAAA;SACjB;QAED,OAAO;YACH,IAAI;gBACA,IAAI,IAAI,qBACD,IAAI,CAAC,IAAI,CACf,CAAA;gBACD,OAAO,IAAI,CAAC,WAAW,CAAA;gBACvB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;gBAChB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;aACzB;YAAC,OAAM,EAAE,OAAO,EAAE,EAAE;gBACjB,IAAI;oBACA,IAAI,GAAG,GAAG,CAAC,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;oBAClC,IAAG,GAAG,CAAC,MAAM,CAAC,KAAK,gBAAgB;wBAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;iBACvD;gBAAC,OAAM,CAAC,EAAE;oBACP,IAAI,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAA;iBACvB;aACJ;SACJ;QAED,KAAK,CAAC,GAAG;YACL,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE;gBACzC,EAAE,CAAC,IAAI,CAAC,IAAI,EAAC,GAAG,CAAC,CAAA;aACpB,CAAC,CAAA;SACL;;;;;;;;QASD,KAAK,CAAC,IAAmB;YACrB,MAAM,SAAS,GAAG;gBACd,QAAQ,MAAK;aAChB,CAAA;;;;;YAMD,MAAM,aAAa,GAAG,IAAI;gBACtB,CAAC,CAAC,MAAM,CAAC,IAAI,EAAC;oBACV,WAAW,EAAE,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC;iBAC1C,CAAC,CAAA;aACL,CAAA;YAED,OAAO,IAAI,iCAAM,IAAI,GAAK,SAAS,EAAG,CAAC,IAAI,CAAC,CAAC;gBAEzC,IAAI,EAAE,aAAa,EAAE,GAAG,IAAI,CAAC,MAAM,CAAA;gBACnC,IAAI,IAAI,GAAmB,CAAC,CAAC,aAAa,CAAC,CAAQ,CAAC,CAAA;;;gBAKpD,IAAG,aAAa,IAAI,OAAO,aAAa,KAAK,UAAU,EAAE;oBACrD,CAAC,GAAG,aAAa,CAAC,CAAC,CAAC,CAAA;iBAC2B;;gBAGnD,IAAI,GAAG,CAAA;gBACP,KAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,IAAI,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,GAAG;oBAC/D,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,IAAI,KAAK,QAAQ,GAAG,CAAC,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAA;iBAChG;gBAED,aAAa,CAAC,IAAI,CAAC,CAAA;gBACnB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;aACnB,CAAC,CAAC,KAAK,CAAC,CAAC,IAAoB;gBAC1B,IAAI,GAAG,CAAA;gBACP,IAAG,OAAO,IAAI,KAAK,QAAQ,EAAE;oBACzB,GAAG,mBACC,GAAG,EAAE,IAAI,IACL,IAAI,KAAK,gBAAgB,GAAG,EAAE,MAAM,EAAE,qBAAqB,EAAE,GAAG,EAAE,CACzE,CAAA;iBACJ;;oBAEI,GAAG,GAAG,IAAI,CAAA;gBACf,aAAa,CAAC,GAAG,CAAC,CAAA;gBAClB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAA;aACjB,CAAC,CAAA;SACL;QAED,OAAO;YACH,IAAG,WAAW,CAAC,MAAM,IAAI,oBAAoB,EAAE,CAAE;iBAC5C;gBACD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;gBAClB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;gBAChB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAA;gBACxB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAA;gBAE1B,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;aACzB;SACJ;KACJ;aAEe,SAAS,CAAC,IAAe;QACrC,IAAG,WAAW,CAAC,MAAM,EAAE;YACnB,IAAI,MAAM,GAAG,WAAW,CAAC,GAAG,EAAE,CAAA;YAC9B,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAA;YACvB,OAAO,MAAM,CAAA;SAChB;aACI;YACD,MAAM,SAAS,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,CAAA;YAClC,OAAO,SAAS,CAAA;SACnB;IACL,CAAC;aAEe,KAAK,CAAC,IAAW;QAC7B,mBAAmB,CAAC,IAAI,CAAC,CAAA;QACzB,IAAG,OAAO,CAAC,MAAM,EAAE;YACf,IAAI,EAAE,GAAG,OAAO,CAAC,GAAG,EAAE,CAAA;YACtB,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,CAAA;YACnB,OAAO,EAAE,CAAA;SACZ;aACI;YACD,MAAM,KAAK,GAAG,IAAI,EAAE,CAAC,IAAI,CAAC,CAAA;YAC1B,OAAO,KAAK,CAAA;SACf;IACL,CAAC;IAED,SAAS,mBAAmB,CAAC,IAAY;QACrC,MAAM,iBAAiB,GAAG,CAAC,GAAW,KAAK,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,SAAS,GAAG,GAAG,CAAA;QACrF,IAAG,IAAI,CAAC,GAAG,EAAE;YACT,IAAI,CAAC,GAAG,GAAG,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;SACzC;aAAM,IAAG,IAAI,CAAC,IAAI,EAAE;YACjB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAC,CAAC,EAAC,IAAI;gBACzB,IAAI,CAAC,CAAC,CAAC,GAAG,iBAAiB,CAAC,GAAG,CAAC,CAAA;aACnC,CAAC,CAAA;SACL;IACL,CAAC;IAED,WAAiB,EAAE;IAiBnB,CAAC,EAjBgB,EAAE,KAAF,EAAE;;IC3enB,MAAM,MAAM,GAAW;QACnB,MAAM,EAAE,EAAE;QACV,KAAK,EAAE,EAAE;KACZ,CAAA;IAED,SAAS,cAAc,CAAC,KAAwB,EAAC,IAAI,EAAC,WAAW,EAAC,IAAgB;QAC9E,EAAE,CAAC,YAAY,CAAC,KAAK,EAAC,IAAI,EAAC,WAAW,EAAC,IAAI,CAAC,CAAA;QAC5C,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAA;IACxB,CAAC;IAED,MAAM,kBAAkB,GAAG;QACvB,YAAY,EAAE;YACV,MAAM,EAAE;gBACJ,GAAG,CAAC,WAAW,EAAC,IAAc;oBAC1B,cAAc,CAAC,QAAQ,EAAC,IAAI,EAAC,WAAW,CAAC,CAAA;iBAC5C;aACJ;YACD,KAAK,EAAE;gBACH,GAAG,CAAC,WAAW,EAAC,IAAc,EAAC,IAAgB;oBAC3C,cAAc,CAAC,OAAO,EAAC,IAAI,EAAC,WAAW,EAAC,IAAI,CAAC,CAAA;iBAChD;aACJ;SACJ;KACJ,CAAA;IAED,CAAC,CAAC,MAAM,CAAC,EAAE,EAAC;QACR,YAAY,EAAE,kBAAkB,CAAC,YAAY;KAChD,CAAC;;IC/BF,MAAM,cAAc,GAAG,KAAK,CAAA;IAI5B,SAAS,KAAK,CAAC,GAAG,OAAO;QACrB,IAAI,EAAK,CAAA;QACT,MAAM,SAAS,GAAG,OAAO,CAAC,CAAC,CAAC,CAAA;QAC5B,IAAG,SAAS,KAAK,IAAI,EAAE;YACnB,IAAG,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,cAAc,EAAE;gBACpC,OAAO,IAAI,OAAO,CAAC,OAAO;oBACtB,qBAAqB,CAAC;wBAClB,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAA;wBACtB,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,CAAA;qBACxB,CAAC,CAAA;iBACL,CAAC,CAAA;aACL;YACD,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAA;YACtB,OAAO,EAAE,CAAC,OAAO,EAAE,CAAA;SACtB;aAAM;YACH,IAAG,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,cAAc,EAAE;gBACpC,OAAO,IAAI,OAAO,CAAC,OAAO;oBACtB,qBAAqB,CAAC;wBAClB,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,CAAA;wBACrB,OAAO,CAAC,EAAE,CAAC,CAAA;qBACd,CAAC,CAAA;iBACL,CAAC,CAAA;aACL;YACD,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,CAAA;YACrB,OAAO,EAAE,CAAA;SACZ;IACL,CAAC;IAED,SAAS,QAAQ,CAAC,OAAc;QAC5B,OAAO,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;IAC/B,CAAC;IAED,SAAS,UAAU;QACf,KAAI,IAAI,KAAK,IAAI,MAAM,EAAE;YACrB,IAAI,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,CAAA;YAC3B,KAAI,IAAI,IAAI,IAAI,OAAO,EAAE;gBACrB,EAAE,CAAC,YAAY,CAAC,KAAY,EAAC,IAAI,EAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAA;gBAChD,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAA;aACvB;SACJ;IACL,CAAC;IAED,SAAS,qBAAqB,CAAC,EAAW;QACtC,SAAS,CAAC,cAAc,EAAE,EAAE,CAAC,CAAA;IACjC,CAAC;IAED,SAAS,SAAS,CAAC,IAAI,EAAE,EAAE;QACvB,QAAQ,CAAC;YACL,GAAG,EAAE,aAAa,IAAI,QAAQ;YAC9B,OAAO,EAAE,GAAG;SACf,CAAC,CAAC,IAAI,CAAC;YACJ,eAAe,CAAC,IAAI,CAAC,CAAA;YACrB,EAAE,EAAE,CAAA;SACP,EAAE;YACC,SAAS,CAAC,IAAI,GAAG,CAAC,EAAE,EAAE,CAAC,CAAA;SAC1B,CAAC,CAAA;IACN,CAAC;IAED,SAAS,QAAQ;QACb,UAAU,EAAE,CAAA;IAChB,CAAC;IAED,QAAQ,EAAE;;;;;;;;;;;;"}